(()=>{"use strict";var n={365:(n,t,e)=>{e.d(t,{A:()=>s});var a=e(601),r=e.n(a),i=e(314),o=e.n(i)()(r());o.push([n.id,':root {\n  --bg-start: #0f0b1a;\n  --bg-end: #1b1030;\n  --text: #eae6f2;\n  --muted: #b9a7d9;\n  --accent: #9b5cff;\n  --accent-2: #ff6ec7;\n  --panel: #1a1230;\n  --panel-border: #3a1c6b;\n  --shadow: rgba(0, 0, 0, 0.35);\n}\n\nhtml { background-color: transparent; }\n\nbody {\n  display: flex;\n  flex-grow: 1;\n  align-items: center;\n  min-height: 100vh;\n  flex-direction: column;\n  margin: 0;\n  background: linear-gradient(140deg, var(--bg-start), var(--bg-end));\n  color: var(--text);\n  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";\n}\n\n/* Utility */\n.is-hidden { display: none !important; }\n\n/* Optional legacy containers kept for compatibility */\n#grid-container, .img-canvas { display: none; }\n\nbutton {\n  border: 1px solid color-mix(in oklab, var(--accent) 60%, white 0%);\n  background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 40%, black 15%), color-mix(in oklab, var(--accent) 25%, black 25%));\n  color: #fff;\n  padding: 10px 14px; /* smaller */\n  font-size: 14px;    /* smaller */\n  font-weight: 700;\n  min-width: 120px;   /* smaller */\n  border-radius: 10px;\n  margin: 6px;\n  position: relative;\n  box-shadow: 0 8px 20px var(--shadow);\n  transition: transform .15s ease, box-shadow .2s ease, background .2s ease;\n  cursor: pointer;\n}\nbutton:hover { transform: translateY(-1px); box-shadow: 0 10px 26px var(--shadow); }\nbutton:active { transform: translateY(1px); box-shadow: 0 6px 14px var(--shadow); }\nbutton:focus-visible { outline: 2px solid var(--accent-2); outline-offset: 2px; }\n\ncanvas {\n  border-radius: 12px;\n  background: #0c0c12; /* dark so white strokes are visible */\n  /* subtle light edge + soft light glow to emphasize boundary */\n  box-shadow: 0 0 0 2px rgba(255,255,255,0.06), 0 4px 14px rgba(255,255,255,0.08), 0 16px 40px var(--shadow);\n  border: 1px solid rgba(255,255,255,0.10);\n}\n\n/* Pixel preview colors (naming kept to match existing JS) */\n.black { background-color: #fff; }\n.white { background-color: transparent; }\n\n/* Main layout */\n.parent {\n  display: grid;\n  grid-template-columns: 1.25fr 0.9fr 0.9fr 0.9fr; /* densified columns without empty spacer */\n  grid-template-rows: auto auto 1fr;\n  gap: 12px; /* tighter gap */\n  width: min(1200px, 92vw);\n  padding: 24px 16px 48px;\n}\n\n#drawingCanvas { grid-area: 1 / 1 / 3 / 3; } /* Canvas keeps spanning first two cols */\n\n/* Combined preview container */\n#resultPreview {\n  grid-area: 1 / 2 / 3 / 3; /* spans two rows to hold digit + label */\n  display: grid;\n  grid-template-rows: auto auto;\n  gap: 8px;\n  align-content: start;\n  background: color-mix(in oklab, var(--panel) 92%, black 0%);\n  border: 1px solid var(--panel-border);\n  border-radius: 12px;\n  box-shadow: 0 16px 40px var(--shadow);\n  padding: 12px;\n  align-self: start;\n  z-index: 1;\n  width: max-content;        /* shrink-wrap to digit + label */\n  justify-self: start;       /* do not stretch to full column */\n  justify-items: start;      /* align inner content to left */\n}\n\n#resultPreview #digitResult {\n  width: 160px;\n  height: 160px;\n  display: grid;\n  grid-template-columns: repeat(20, 1fr);\n  grid-template-rows: repeat(20, 1fr);\n}\n\n#resultPreview #predictionLabel {\n  color: var(--muted);\n  font-weight: 600;\n  font-size: 1.1rem;\n}\n\n/* Remove old grid positions to avoid conflicts */\n#digitResult { grid-area: auto; }\n#predictionLabel { grid-area: auto; }\n\n/* Canvas wrapper and hint */\n.canvas-wrap { position: relative; width: max-content; }\n.canvas-hint {\n  position: absolute;\n  inset: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--muted);\n  background: rgba(0,0,0,0.2);\n  border-radius: 12px;\n  text-align: center;\n  padding: 12px;\n  pointer-events: none;\n  transition: opacity .25s ease;\n}\n.canvas-hint.is-hidden { opacity: 0; }\n\n/* Keep chart in place; allow internal growth */\n#predictionList { position: relative; }\n#predictionList canvas#chart { display: block; width: 100%; height: auto; }\n\n#predictions { display: none; }\n.prediction { font-size: 18px; font-weight: 600; color: var(--accent-2); text-align: center; }\n\n/* Reveal animations: keep simple opacity so charts don\'t slide */\n#digitResult:not(.is-hidden),\n#predictionLabel:not(.is-hidden) { animation: fadeInOpacity .2s ease-out; }\n@keyframes fadeInOpacity { from { opacity: 0;} to { opacity: 1;} }\n\n/* === 3 cols x 2 rows layout (overrides) === */\n.parent {\n  grid-template-columns: 1.3fr 1fr 1fr; /* 3 columns */\n  grid-template-rows: auto auto;       /* 2 rows */\n}\n\n/* Grid items (use direct children of .parent) */\n.parent > .canvas-wrap { grid-area: 1 / 1 / 2 / 2; }\n.parent > .buttons     { grid-area: 2 / 1 / 3 / 2; }\n#resultPreview         { grid-area: 1 / 2 / 2 / 3; }\n#predictionList        { grid-area: 1 / 3 / 2 / 4; height: 280px; min-height: 280px; }\n\n/* Keep buttons compact in their single cell */\n.parent > .buttons {\n  grid-template-columns: repeat(2, minmax(120px, auto));\n  justify-content: start;\n  align-items: start;\n}\n\n/* Mobile: stack vertically in this order: canvas, buttons, preview, chart */\n@media (max-width: 900px) {\n  .parent {\n    display: grid;\n    grid-template-columns: 1fr;\n    grid-template-rows: auto auto auto auto;\n    grid-template-areas:\n      "canvas"\n      "buttons"\n      "preview"\n      "chart";\n  }\n  .parent > .canvas-wrap { grid-area: canvas; }\n  .parent > .buttons     { grid-area: buttons; }\n  #resultPreview         { grid-area: preview; min-height: 180px; width: fit-content; margin: 8px auto; z-index: 2; }\n  #predictionList        { grid-area: chart; width: 100%; }\n}\n@media (max-width: 520px) {\n  .parent > .buttons { grid-template-columns: 1fr; }\n  #predictionList    { height: 200px; min-height: 200px; }\n}\n\n/* === Layout tweaks: narrower preview column, centered full-width buttons, smaller mobile charts === */\n.parent { grid-template-columns: 1.3fr 0.8fr 1fr; }\n\n.parent > .buttons {\n  grid-template-columns: 1fr 1fr; /* two equal columns */\n  justify-content: stretch;       /* center via stretching */\n  justify-items: stretch;\n  align-items: stretch;\n}\n.parent > .buttons button { width: 100%; margin: 0; }\n\n@media (max-width: 900px) {\n  #predictionList { height: 200px; min-height: 200px; }\n}\n@media (max-width: 520px) {\n  #predictionList { height: 180px; min-height: 180px; }\n}\n\n/* === Buttons layout: two buttons at 40% each with more spacing === */\n.parent > .buttons {\n  display: flex;\n  justify-content: center; /* center the pair */\n  align-items: stretch;\n  gap: 16px; /* add space between buttons */\n}\n.parent > .buttons button {\n  flex: 0 0 40%;\n  max-width: 40%;\n  width: 40%;\n  margin: 0; /* spacing handled by gap */\n}\n\n/* Responsive: allow wrapping and adjust widths */\n@media (max-width: 900px) {\n  .parent > .buttons {\n    display: flex !important;\n    flex-wrap: wrap;\n    justify-content: center; /* center group */\n    align-items: center;\n    gap: 12px;\n    min-height: 56px; /* ensure row has height */\n    padding: 8px 0;\n    z-index: 2; /* stay above adjacent panels if overlapping */\n  }\n  .parent > .buttons button {\n    flex: 1 1 48%;\n    max-width: 48%;\n    width: auto;\n  }\n}\n@media (max-width: 520px) {\n  .parent > .buttons {\n    justify-content: stretch;\n  }\n  .parent > .buttons button {\n    flex: 1 1 100%;\n    max-width: 100%;\n  }\n}\n\n/* === Center contents in their grid cells === */\n.parent > * { justify-self: center; align-self: center; }\n.parent > .canvas-wrap { justify-self: center; align-self: center; }\n\n/* Add horizontal outer margin to charts */\n#predictionList { margin-inline: 16px; }\n\n/* Keep mobile stacking unaffected */\n@media (max-width: 900px) {\n  #predictionList { margin-inline: 12px; }\n}\n\n/* === Chart container constraints & wrapping fixes === */\n#predictionList {\n  /* override global centering to avoid shrink-to-content loops */\n  justify-self: start;\n  align-self: start;\n  /* do not let content force grid track expansion */\n  min-width: 0;\n  /* fill available space but never exceed a sane max on desktop */\n  width: 100%;\n  max-width: 100%;\n  box-sizing: border-box;\n  /* inner breathing room so chart doesn\'t touch cell edge */\n  padding-right: 12px;\n  /* avoid clipping: allow scrollbars if content temporarily overflows */\n  overflow: auto;\n}\n\n@media (max-width: 900px) {\n  #predictionList { padding-right: 10px; }\n}\n\n/* ensure chart canvas never exceeds container */\n#predictionList canvas#chart {\n  max-width: 100%;\n  height: 100%; /* match container height (set above via existing rules) */\n}\n\n/* prevent other grid children from forcing track growth */\n.parent > .buttons,\n#resultPreview {\n  min-width: 0;\n  max-width: 100%;\n}\n\n/* help long labels wrap instead of overflow */\n#predictionLabel { \n  overflow-wrap: anywhere; \n  word-break: break-word; \n}\n\n/* Training panel and section */\n.training-section { margin: 40px auto 80px; width: min(900px,92vw); padding: 16px 20px 28px; background: rgba(255,255,255,0.03); border:1px solid var(--panel-border); border-radius:16px; box-shadow:0 8px 32px -8px var(--shadow); }\n.training-section h2 { margin:0 0 12px; font-size:1.25rem; font-weight:600; letter-spacing:.5px; }\n.training-section #trainButton { margin: 4px 0 16px; }\n.training-panel { background:rgba(0,0,0,0.25); border:1px solid color-mix(in oklab,var(--panel-border) 70%,#fff 0%); padding:14px 16px 18px; border-radius:14px; font-size:13px; }\n.training-panel .tp-header { font-weight:600; margin-bottom:8px; display:flex; flex-wrap:wrap; gap:12px; }\n.training-panel progress { width:100%; height:12px; margin:4px 0 12px; border-radius:6px; overflow:hidden; }\n.training-panel #tpMetrics { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px; }\n.training-panel #tpMetrics span { background:rgba(255,255,255,0.07); padding:4px 8px; border-radius:8px; font-family:monospace; }\n.training-panel #tpLog { max-height:180px; overflow:auto; margin:0; background:rgba(0,0,0,0.25); padding:8px 10px; border-radius:8px; font-family:monospace; line-height:1.25; }\n.train-sample-wrap { margin-top:18px; display:flex; flex-direction:column; align-items:flex-start; gap:6px; }\n.train-sample-wrap canvas { image-rendering:pixelated; width:100px; height:100px; border:1px solid rgba(255,255,255,0.18); background:#0c0c12; box-shadow:0 4px 18px -2px var(--shadow),0 0 0 2px rgba(255,255,255,0.05); border-radius:8px; }\n.train-sample-label { margin:0; font-size:12px; letter-spacing:.5px; color:var(--muted); text-transform:uppercase; }',""]);const s=o},314:n=>{n.exports=function(n){var t=[];return t.toString=function(){return this.map((function(t){var e="",a=void 0!==t[5];return t[4]&&(e+="@supports (".concat(t[4],") {")),t[2]&&(e+="@media ".concat(t[2]," {")),a&&(e+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),e+=n(t),a&&(e+="}"),t[2]&&(e+="}"),t[4]&&(e+="}"),e})).join("")},t.i=function(n,e,a,r,i){"string"==typeof n&&(n=[[null,n,void 0]]);var o={};if(a)for(var s=0;s<this.length;s++){var d=this[s][0];null!=d&&(o[d]=!0)}for(var c=0;c<n.length;c++){var l=[].concat(n[c]);a&&o[l[0]]||(void 0!==i&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=i),e&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=e):l[2]=e),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),t.push(l))}},t}},601:n=>{n.exports=function(n){return n[1]}},72:n=>{var t=[];function e(n){for(var e=-1,a=0;a<t.length;a++)if(t[a].identifier===n){e=a;break}return e}function a(n,a){for(var i={},o=[],s=0;s<n.length;s++){var d=n[s],c=a.base?d[0]+a.base:d[0],l=i[c]||0,p="".concat(c," ").concat(l);i[c]=l+1;var u=e(p),m={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==u)t[u].references++,t[u].updater(m);else{var g=r(m,a);a.byIndex=s,t.splice(s,0,{identifier:p,updater:g,references:1})}o.push(p)}return o}function r(n,t){var e=t.domAPI(t);return e.update(n),function(t){if(t){if(t.css===n.css&&t.media===n.media&&t.sourceMap===n.sourceMap&&t.supports===n.supports&&t.layer===n.layer)return;e.update(n=t)}else e.remove()}}n.exports=function(n,r){var i=a(n=n||[],r=r||{});return function(n){n=n||[];for(var o=0;o<i.length;o++){var s=e(i[o]);t[s].references--}for(var d=a(n,r),c=0;c<i.length;c++){var l=e(i[c]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}i=d}}},659:n=>{var t={};n.exports=function(n,e){var a=function(n){if(void 0===t[n]){var e=document.querySelector(n);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(n){e=null}t[n]=e}return t[n]}(n);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}},540:n=>{n.exports=function(n){var t=document.createElement("style");return n.setAttributes(t,n.attributes),n.insert(t,n.options),t}},56:(n,t,e)=>{n.exports=function(n){var t=e.nc;t&&n.setAttribute("nonce",t)}},825:n=>{n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=n.insertStyleElement(n);return{update:function(e){!function(n,t,e){var a="";e.supports&&(a+="@supports (".concat(e.supports,") {")),e.media&&(a+="@media ".concat(e.media," {"));var r=void 0!==e.layer;r&&(a+="@layer".concat(e.layer.length>0?" ".concat(e.layer):""," {")),a+=e.css,r&&(a+="}"),e.media&&(a+="}"),e.supports&&(a+="}");var i=e.sourceMap;i&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(a,n,t.options)}(t,n,e)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(t)}}}},113:n=>{n.exports=function(n,t){if(t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}}},t={};function e(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={id:a,exports:{}};return n[a](i,i.exports,e),i.exports}e.n=n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},e.d=(n,t)=>{for(var a in t)e.o(t,a)&&!e.o(n,a)&&Object.defineProperty(n,a,{enumerable:!0,get:t[a]})},e.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t),e.nc=void 0;var a=e(72),r=e.n(a),i=e(825),o=e.n(i),s=e(659),d=e.n(s),c=e(56),l=e.n(c),p=e(540),u=e.n(p),m=e(113),g=e.n(m),f=e(365),h={};h.styleTagTransform=g(),h.setAttributes=l(),h.insert=d().bind(null,"head"),h.domAPI=o(),h.insertStyleElement=u(),r()(f.A,h),f.A&&f.A.locals&&f.A.locals;let x=null;let v=!1,w=0,b=0;!async function(){let n,t;try{n=await async function(){const n=await tf.loadLayersModel("./models/model.json");return console.log("Model loaded successfully"),n}(),function(){const t=document.getElementById("drawingCanvas"),e=t.getContext("2d"),a=document.getElementById("canvasHint");e.fillStyle="white",e.lineCap="round",e.lineJoin="round";const r=(n,e)=>{v=!0,[w,b]=[n,e],t.style.cursor="crosshair",a?.classList.add("is-hidden")},i=(n,t)=>{v&&(e.beginPath(),e.moveTo(w,b),e.lineTo(n,t),e.lineWidth=30,e.strokeStyle="white",e.stroke(),[w,b]=[n,t])};t.addEventListener("mousedown",(n=>r(n.offsetX,n.offsetY))),t.addEventListener("mousemove",(n=>i(n.offsetX,n.offsetY))),t.addEventListener("mouseup",(()=>{v=!1,t.style.cursor="default"})),t.addEventListener("mouseout",(()=>{v=!1,t.style.cursor="default"})),t.addEventListener("touchstart",(n=>{const e=n.touches[0],a=t.getBoundingClientRect();r(e.clientX-a.left,e.clientY-a.top)})),t.addEventListener("touchmove",(n=>{if(!v)return;const e=n.touches[0],a=t.getBoundingClientRect();i(e.clientX-a.left,e.clientY-a.top),n.preventDefault()})),t.addEventListener("touchend",(()=>{v=!1,t.style.cursor="default"})),t.addEventListener("touchcancel",(()=>{v=!1,t.style.cursor="default"})),document.getElementById("predictButton").addEventListener("click",(async()=>{const t=document.getElementById("resultPreview"),e=document.getElementById("predictionList");t?.classList.remove("is-hidden"),e?.classList.remove("is-hidden"),await new Promise(requestAnimationFrame);const a=function(){const n=document.getElementById("drawingCanvas"),t=n.getContext("2d").getImageData(0,0,n.width,n.height).data,e=20,a=n.width/e,r=n.height/e;let i=Array.from({length:e},(()=>Array(e).fill(0)));for(let o=0;o<e;o++)for(let s=0;s<e;s++){const e=Math.floor(s*a),d=Math.floor(o*r),c=Math.floor((s+1)*a),l=Math.floor((o+1)*r);let p=0,u=0;for(let a=d;a<l;a++)for(let r=e;r<c;r++){const e=4*(a*n.width+r);p+=(t[e]+t[e+1]+t[e+2])/3,u++}const m=p/u>=128?1:0;i[o][s]=m}const o=Array.from({length:e},((n,t)=>i.map((n=>n[t])))).flat();return tf.tensor2d(o,[1,400])}();await async function(n,t){if(!(n instanceof tf.Tensor))throw new Error("imageData must be a Tensor");const e=t.predict(n),a=await e.array(),r=e.argMax(-1).dataSync()[0];return function(n,t){const e=document.getElementById("resultPreview");e?.classList.remove("is-hidden"),document.getElementById("predictionLabel").innerHTML=`Predicted digit: ${t}<br>with ${(100*n[0][t]).toFixed(2)}% of certainty`;const a=document.getElementById("chart").getContext("2d");x&&x.destroy(),x=new Chart(a,{type:"bar",data:{labels:Array.from({length:10},((n,t)=>t)),datasets:[{label:"Predictions",data:n[0].map((n=>100*n)),backgroundColor:"rgba(0, 0, 255, 0.2)",borderColor:"rgba(0, 0, 255, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:500},scales:{x:{ticks:{font:{size:16},color:"white"}},y:{beginAtZero:!0,ticks:{font:{size:16},color:"white"}}},plugins:{legend:{labels:{font:{size:16},color:"white"}}}}})}(a,r),function(n){const t=n.reshape([20,20]).arraySync(),e=t[0].map(((n,e)=>t.map((n=>n[e]))));let a=document.getElementById("digitResult");a.innerHTML="";for(const n of e)for(const t of n){const n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.className=t>.5?"black":"white",a.appendChild(n)}}(n),r}(a,n)}))}(),document.getElementById("clearButton").addEventListener("click",(()=>{!function(){const n=document.getElementById("drawingCanvas");n.getContext("2d").clearRect(0,0,n.width,n.height);const t=document.getElementById("canvasHint");t?.classList.remove("is-hidden")}();const n=document.getElementById("resultPreview"),t=document.getElementById("digitResult"),e=document.getElementById("predictionLabel"),a=document.getElementById("predictionList");t&&(t.innerHTML=""),e&&(e.innerHTML=""),n?.classList.add("is-hidden"),a?.classList.add("is-hidden"),x&&(x.destroy(),x=null)}));const e=document.getElementById("trainButton"),a=document.getElementById("trainSampleWrap"),r=document.getElementById("trainSampleCanvas"),i=r?.getContext("2d"),o=document.getElementById("trainSampleDigit");function s(n){if(!i)return;const t=20,e=new ImageData(t,t);for(let a=0;a<t;a++)for(let r=0;r<t;r++){const i=n[a+r*t],o=Math.pow(i,.85),s=Math.round(255*o),d=4*(a*t+r);e.data[d]=255,e.data[d+1]=255,e.data[d+2]=255,e.data[d+3]=s}const a=document.createElement("canvas");a.width=t,a.height=t,a.getContext("2d").putImageData(e,0,0),i.imageSmoothingEnabled=!1,i.clearRect(0,0,100,100),i.drawImage(a,0,0,t,t,2,2,96,96)}e?.addEventListener("click",(async()=>{t&&clearInterval(t),e.disabled=!0,e.textContent="Training...";try{const{X:n,y:e,rawX:r}=await async function(){const n=await fetch("./data/X.json"),t=await fetch("./data/y.json");let e=await n.json(),a=await t.json();const r=e.map((n=>n.slice()));return e=e.map((n=>n.map((n=>n>.5?1:0)))),Array.isArray(a)&&Array.isArray(a[0])&&(a=a.map((n=>n[0]))),{X:tf.tensor2d(e),y:tf.tensor1d(a),rawX:r}}(),i=await e.data(),d=function(){const n=tf.sequential();return n.add(tf.layers.dense({units:128,activation:"relu",inputShape:[400]})),n.add(tf.layers.dropout({rate:.5})),n.add(tf.layers.dense({units:64,activation:"relu"})),n.add(tf.layers.dense({units:10,activation:"softmax"})),n}();a?.classList.remove("is-hidden"),t=setInterval((()=>{const n=Math.floor(Math.random()*r.length);s(r[n]),o&&(o.textContent=i[n])}),100),await async function(n,t,e,{epochs:a=40,batchSize:r=32}={}){const i=document.getElementById("trainingPanel"),o=document.getElementById("tpEpoch"),s=document.getElementById("tpProgress"),d=document.getElementById("tpMetrics"),c=document.getElementById("tpLog"),l=document.getElementById("tpTime");i?.classList.remove("is-hidden"),o.textContent=`0/${a}`,s.value=0,s.max=100,d.innerHTML="",c.textContent="";const p=performance.now();return n.compile({loss:"sparseCategoricalCrossentropy",optimizer:tf.train.adam(5e-4),metrics:["accuracy"]}),await n.fit(t,e,{epochs:a,batchSize:r,shuffle:!0,callbacks:{onEpochEnd:(n,t)=>{const e=(t.acc??t.accuracy??0).toFixed(4);o.textContent=`${n+1}/${a}`,s.value=(n+1)/a*100;const r=((performance.now()-p)/1e3).toFixed(1);l.textContent=`${r}s`,d.innerHTML=`<span>loss: ${t.loss.toFixed(4)}</span><span>acc: ${e}</span>`,c.textContent+=`Epoch ${n+1}: loss=${t.loss.toFixed(4)} acc=${e}\n`,c.scrollTop=c.scrollHeight},onTrainEnd:()=>{const n=((performance.now()-p)/1e3).toFixed(1);d.innerHTML+="<span>done</span>",l.textContent=`${n}s total`}}})}(d,n,e,{epochs:40,batchSize:32})}catch(n){console.error("Training failed",n)}finally{clearInterval(t),e.textContent="Train New Model",e.disabled=!1}}))}catch(d){console.error("Error during init:",d)}}()})();